import{u as I,r as t,a as n,j as s}from"./index-CpGjGsyF.js";function $(){const{user:m}=I(),[i,N]=t.useState("queue"),[y,k]=t.useState([]),[o,u]=t.useState(null),[x,h]=t.useState([]),[l,g]=t.useState(""),[M,v]=t.useState(!1),[c,w]=t.useState(null),f=t.useRef(null),r=t.useRef(null);t.useEffect(()=>(p(),_(),()=>{r.current&&r.current.close()}),[]),t.useEffect(()=>{C()},[x]);const C=()=>{f.current?.scrollIntoView({behavior:"smooth"})},p=async()=>{try{v(!0);const e=await n.get("chat/sessions/");k(e.data.results||e.data||[])}catch(e){console.error("Error fetching chat sessions:",e)}finally{v(!1)}},_=async()=>{try{const e=await n.get("chat/analytics/summary/");w(e.data)}catch(e){console.error("Error fetching analytics:",e)}},A=async e=>{try{const a=await n.get(`chat/sessions/${e}/messages/`);h(a.data.results||a.data||[])}catch(a){console.error("Error fetching messages:",a)}},R=e=>{r.current&&r.current.close();const a=`ws://localhost:8000/ws/chat/support/${e}/`;r.current=new WebSocket(a),r.current.onopen=()=>{console.log("WebSocket connected")},r.current.onmessage=d=>{const D=JSON.parse(d.data);B(D)},r.current.onclose=()=>{console.log("WebSocket disconnected")},r.current.onerror=d=>{console.error("WebSocket error:",d)}},B=e=>{switch(e.type){case"chat_message":h(a=>[...a,e.message]);break;case"typing_start":break;case"typing_stop":break;case"read_receipt":break;default:console.log("Unknown message type:",e.type)}},j=async()=>{if(!(!l.trim()||!o))try{const e={type:"chat_message",content:l.trim(),message_type:"text"};r.current&&r.current.readyState===WebSocket.OPEN&&r.current.send(JSON.stringify(e)),await n.post(`chat/sessions/${o.id}/messages/`,{content:l.trim(),message_type:"text"}),g("")}catch(e){console.error("Error sending message:",e)}},W=async(e,a)=>{try{await n.post(`chat/sessions/${e}/assign/`,{cashier_id:a}),p()}catch(d){console.error("Error assigning session:",d)}},E=async e=>{try{await n.post(`chat/sessions/${e}/close/`,{notes:"Session closed by cashier"}),u(null),p()}catch(a){console.error("Error closing session:",a)}},b=e=>{u(e),A(e.id),R(e.id)},T=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),S=e=>{switch(e){case"active":return"var(--md-sys-color-secondary)";case"waiting":return"var(--md-sys-color-tertiary)";case"closed":return"var(--md-sys-color-error)";default:return"var(--md-sys-color-on-surface-variant)"}};return s.jsxs("div",{className:"md-elevated-card md-animate-slide-in-right",style:{animationDelay:"200ms"},children:[s.jsx("h3",{className:"md-typescale-title-large",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"24px"},children:"ðŸ’¬ Chat Support Center"}),s.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",padding:"4px",background:"var(--md-sys-color-surface-container-highest)",borderRadius:"var(--md-sys-shape-corner-large)"},children:[{id:"queue",name:"Queue",icon:"ðŸ“‹"},{id:"active",name:"Active Chats",icon:"ðŸ’¬"},{id:"analytics",name:"Analytics",icon:"ðŸ“Š"}].map(e=>s.jsxs("button",{onClick:()=>N(e.id),className:"md-ripple",style:{flex:1,padding:"12px 16px",background:i===e.id?"var(--md-sys-color-surface)":"transparent",border:"none",borderRadius:"var(--md-sys-shape-corner-medium)",color:i===e.id?"var(--md-sys-color-on-surface)":"var(--md-sys-color-on-surface-variant)",fontWeight:i===e.id?"600":"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard)",boxShadow:i===e.id?"var(--md-sys-elevation-1)":"none"},children:[s.jsx("span",{style:{fontSize:"20px"},children:e.icon}),s.jsx("span",{className:"md-typescale-label-large",children:e.name})]},e.id))}),i==="queue"&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"24px"},children:[s.jsxs("div",{children:[s.jsx("h4",{className:"md-typescale-title-medium",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"16px"},children:"Waiting Sessions"}),s.jsx("div",{style:{maxHeight:"500px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"8px"},children:y.filter(e=>e.status==="waiting").length===0?s.jsx("div",{style:{padding:"40px 20px",textAlign:"center",color:"var(--md-sys-color-on-surface-variant)"},children:s.jsx("p",{className:"md-typescale-body-medium",children:"No sessions in queue"})}):y.filter(e=>e.status==="waiting").map(e=>s.jsxs("div",{onClick:()=>b(e),className:"md-list-item md-ripple",style:{padding:"16px",background:"var(--md-sys-color-surface-container-low)",borderRadius:"var(--md-sys-shape-corner-medium)",cursor:"pointer",border:o?.id===e.id?"2px solid var(--md-sys-color-primary)":"none"},children:[s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{className:"md-typescale-title-small",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"4px"},children:e.customer_name||"Anonymous Customer"}),s.jsx("div",{className:"md-typescale-body-small",style:{color:"var(--md-sys-color-on-surface-variant)",marginBottom:"4px"},children:e.subject||"General Inquiry"}),s.jsx("div",{className:"md-typescale-body-small",style:{color:"var(--md-sys-color-on-surface-variant)"},children:new Date(e.started_at).toLocaleString()})]}),s.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:S(e.status),flexShrink:0}})]},e.id))})]}),s.jsx("div",{children:o?s.jsxs("div",{style:{height:"500px",display:"flex",flexDirection:"column",border:"1px solid var(--md-sys-color-outline)",borderRadius:"var(--md-sys-shape-corner-medium)"},children:[s.jsx("div",{style:{padding:"16px",borderBottom:"1px solid var(--md-sys-color-outline)",background:"var(--md-sys-color-surface-container-low)"},children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{className:"md-typescale-title-medium",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"4px"},children:o.customer_name||"Anonymous Customer"}),s.jsx("div",{className:"md-typescale-body-small",style:{color:"var(--md-sys-color-on-surface-variant)"},children:o.subject||"General Inquiry"})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx("button",{onClick:()=>W(o.id,m.id),className:"md-filled-button md-ripple",style:{background:"var(--md-sys-color-primary)",color:"var(--md-sys-color-on-primary)",padding:"8px 16px"},children:"Assign to Me"}),s.jsx("button",{onClick:()=>E(o.id),className:"md-outlined-button md-ripple",style:{padding:"8px 16px"},children:"Close"})]})]})}),s.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px",display:"flex",flexDirection:"column",gap:"12px"},children:[x.map(e=>s.jsx("div",{style:{alignSelf:e.sender===m.email?"flex-end":"flex-start",maxWidth:"70%"},children:s.jsxs("div",{style:{padding:"12px 16px",borderRadius:"var(--md-sys-shape-corner-medium)",background:e.sender===m.email?"var(--md-sys-color-primary)":"var(--md-sys-color-surface-container-high)",color:e.sender===m.email?"var(--md-sys-color-on-primary)":"var(--md-sys-color-on-surface)"},children:[s.jsx("div",{className:"md-typescale-body-medium",style:{marginBottom:"4px"},children:e.content}),s.jsx("div",{className:"md-typescale-body-small",style:{opacity:.7,fontSize:"12px"},children:T(e.timestamp)})]})},e.id)),s.jsx("div",{ref:f})]}),s.jsx("div",{style:{padding:"16px",borderTop:"1px solid var(--md-sys-color-outline)",background:"var(--md-sys-color-surface-container-low)"},children:s.jsxs("div",{style:{display:"flex",gap:"12px"},children:[s.jsx("input",{type:"text",value:l,onChange:e=>g(e.target.value),onKeyPress:e=>e.key==="Enter"&&j(),placeholder:"Type your message...",className:"md-filled-text-field",style:{flex:1,padding:"12px",border:"none",borderRadius:"var(--md-sys-shape-corner-medium)",background:"var(--md-sys-color-surface)",color:"var(--md-sys-color-on-surface)"}}),s.jsx("button",{onClick:j,disabled:!l.trim(),className:"md-filled-button md-ripple",style:{background:l.trim()?"var(--md-sys-color-primary)":"var(--md-sys-color-surface-container-high)",color:l.trim()?"var(--md-sys-color-on-primary)":"var(--md-sys-color-on-surface-variant)",border:"none",borderRadius:"var(--md-sys-shape-corner-medium)",padding:"12px 24px",cursor:l.trim()?"pointer":"not-allowed"},children:"Send"})]})})]}):s.jsx("div",{style:{height:"500px",display:"flex",alignItems:"center",justifyContent:"center",border:"2px dashed var(--md-sys-color-outline)",borderRadius:"var(--md-sys-shape-corner-medium)",color:"var(--md-sys-color-on-surface-variant)"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ’¬"}),s.jsx("p",{className:"md-typescale-body-large",children:"Select a session to start chatting"})]})})})]}),i==="active"&&s.jsxs("div",{children:[s.jsx("h4",{className:"md-typescale-title-medium",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"16px"},children:"Active Chat Sessions"}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"16px"},children:y.filter(e=>e.status==="active").map(e=>s.jsx("div",{onClick:()=>b(e),className:"md-filled-card md-ripple",style:{padding:"16px",cursor:"pointer",border:o?.id===e.id?"2px solid var(--md-sys-color-primary)":"none"},children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{className:"md-typescale-title-medium",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"4px"},children:e.customer_name||"Anonymous Customer"}),s.jsx("div",{className:"md-typescale-body-medium",style:{color:"var(--md-sys-color-on-surface-variant)",marginBottom:"8px"},children:e.subject||"General Inquiry"}),s.jsxs("div",{className:"md-typescale-body-small",style:{color:"var(--md-sys-color-on-surface-variant)"},children:[e.message_count," messages â€¢ ",new Date(e.last_message_at).toLocaleString()]})]}),s.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:S(e.status),flexShrink:0}})]})},e.id))})]}),i==="analytics"&&c&&s.jsxs("div",{children:[s.jsx("h4",{className:"md-typescale-title-medium",style:{color:"var(--md-sys-color-on-surface)",marginBottom:"16px"},children:"Chat Analytics Summary"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[s.jsxs("div",{className:"md-filled-card",style:{padding:"16px"},children:[s.jsx("div",{className:"md-typescale-body-medium",style:{color:"var(--md-sys-color-on-surface-variant)"},children:"Total Sessions Today"}),s.jsx("div",{className:"md-typescale-title-large",style:{fontWeight:"600"},children:c.total_sessions})]}),s.jsxs("div",{className:"md-filled-card",style:{padding:"16px"},children:[s.jsx("div",{className:"md-typescale-body-medium",style:{color:"var(--md-sys-color-on-surface-variant)"},children:"Active Sessions"}),s.jsx("div",{className:"md-typescale-title-large",style:{fontWeight:"600"},children:c.active_sessions})]}),s.jsxs("div",{className:"md-filled-card",style:{padding:"16px"},children:[s.jsx("div",{className:"md-typescale-body-medium",style:{color:"var(--md-sys-color-on-surface-variant)"},children:"Total Messages"}),s.jsx("div",{className:"md-typescale-title-large",style:{fontWeight:"600"},children:c.total_messages})]}),s.jsxs("div",{className:"md-filled-card",style:{padding:"16px"},children:[s.jsx("div",{className:"md-typescale-body-medium",style:{color:"var(--md-sys-color-on-surface-variant)"},children:"Average Satisfaction"}),s.jsx("div",{className:"md-typescale-title-large",style:{fontWeight:"600"},children:c.average_satisfaction?`${c.average_satisfaction}/5`:"N/A"})]})]})]})]})}export{$ as default};
