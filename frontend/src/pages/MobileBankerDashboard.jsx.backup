import React, { useState, useEffect } from 'react';
import { useAuth } from '../context/AuthContext';
import { formatCurrencyGHS } from '../utils/formatters';
import { api } from '../services/api.ts';
import { useNavigate } from 'react-router-dom';

function MobileBankerDashboard() {
    const { user, logout } = useAuth();
    const navigate = useNavigate();

    const handleLogout = async () => {
      await logout();
      navigate('/login');
    };
   const [activeTab, setActiveTab] = useState('clients');

   // Modal states
   const [showLoanModal, setShowLoanModal] = useState(false);
   const [showPaymentModal, setShowPaymentModal] = useState(false);
   const [showDepositModal, setShowDepositModal] = useState(false);
   const [showWithdrawalModal, setShowWithdrawalModal] = useState(false);
   const [showKycModal, setShowKycModal] = useState(false);
   const [showVisitModal, setShowVisitModal] = useState(false);
   const [showMessageModal, setShowMessageModal] = useState(false);

   // Form states
   const [loanForm, setLoanForm] = useState({
      applicant_name: '',
      date_of_birth: '',
      applicant_id_type: 'ghana_card',
      applicant_id_number: '',
      digital_address: '',
      town: '',
      city: '',
      next_of_kin_1_name: '',
      next_of_kin_1_relationship: '',
      next_of_kin_1_phone: '',
      next_of_kin_1_address: '',
      next_of_kin_2_name: '',
      next_of_kin_2_relationship: '',
      next_of_kin_2_phone: '',
      next_of_kin_2_address: '',
      guarantor_1_name: '',
      guarantor_1_id_type: 'ghana_card',
      guarantor_1_id_number: '',
      guarantor_1_phone: '',
      guarantor_1_address: '',
      guarantor_2_name: '',
      guarantor_2_id_type: 'ghana_card',
      guarantor_2_id_number: '',
      guarantor_2_phone: '',
      guarantor_2_address: '',
      loan_amount: '',
      loan_purpose: '',
      repayment_period_months: '',
      monthly_income: '',
      employment_status: ''
   });
   const [paymentForm, setPaymentForm] = useState({
      member_id: '',
      amount: '',
      payment_type: 'cash'
   });
   const [depositForm, setDepositForm] = useState({
      member_id: '',
      amount: '',
      deposit_type: 'member_savings',
      account_number: ''
   });
   const [withdrawalForm, setWithdrawalForm] = useState({
      member_id: '',
      amount: '',
      withdrawal_type: 'withdrawal_member_savings',
      account_number: ''
   });
   const [messageForm, setMessageForm] = useState({
     recipient: '',
     subject: '',
     content: '',
     priority: 'normal'
   });
   const [messages, setMessages] = useState([]);
   const [loadingMessages, setLoadingMessages] = useState(false);
   const [metrics, setMetrics] = useState({
     scheduled_visits: 0,
     completed_today: 0,
     collections_due: 0,
     new_applications: 0
   });
   const [loadingMetrics, setLoadingMetrics] = useState(false);

   // Schedule states
   const [scheduledVisits, setScheduledVisits] = useState([]);
   const [loadingVisits, setLoadingVisits] = useState(false);
   const [showScheduleModal, setShowScheduleModal] = useState(false);
   const [scheduleForm, setScheduleForm] = useState({
     client_name: '',
     location: '',
     scheduled_date: '',
     scheduled_time: '',
     purpose: '',
     assigned_to: ''
   });

   // Fetch messages, visits, and metrics on component mount
   useEffect(() => {
     fetchMessages();
     fetchVisits();
     fetchMetrics();
   }, []);

   const fetchMessages = async () => {
     setLoadingMessages(true);
     try {
       const response = await api.get('operations/messages/');
       setMessages(response.data || []);
     } catch (error) {
       console.error('Error fetching messages:', error);
       setMessages([]);
     } finally {
       setLoadingMessages(false);
     }
   };

   const fetchVisits = async () => {
     setLoadingVisits(true);
     try {
       const response = await api.get('operations/visit_schedules/');
       setScheduledVisits(response.data);
     } catch (error) {
       console.error('Error fetching visits:', error);
     } finally {
       setLoadingVisits(false);
     }
   };

   const fetchMetrics = async () => {
     setLoadingMetrics(true);
     try {
       const response = await api.get('operations/mobile-banker-metrics/');
       setMetrics(response.data);
     } catch (error) {
       console.error('Error fetching metrics:', error);
     } finally {
       setLoadingMetrics(false);
     }
   };

  // Handler functions
   const handleQuickAction = (action) => {
      switch (action) {
         case 'loan':
            setShowLoanModal(true);
            break;
         case 'payment':
            setShowPaymentModal(true);
            break;
         case 'deposit':
            setShowDepositModal(true);
            break;
         case 'withdrawal':
            setShowWithdrawalModal(true);
            break;
         case 'kyc':
            setShowKycModal(true);
            break;
         case 'visit':
            setShowVisitModal(true);
            break;
         default:
            break;
      }
   };

   const handleLoanSubmit = async (e) => {
      e.preventDefault();
      try {
         // This would integrate with backend loan application endpoint
         alert('Loan application submitted successfully!');
         setShowLoanModal(false);
         setLoanForm({
            applicant_name: '',
            date_of_birth: '',
            applicant_id_type: 'ghana_card',
            applicant_id_number: '',
            digital_address: '',
            town: '',
            city: '',
            next_of_kin_1_name: '',
            next_of_kin_1_relationship: '',
            next_of_kin_1_phone: '',
            next_of_kin_1_address: '',
            next_of_kin_2_name: '',
            next_of_kin_2_relationship: '',
            next_of_kin_2_phone: '',
            next_of_kin_2_address: '',
            guarantor_1_name: '',
            guarantor_1_id_type: 'ghana_card',
            guarantor_1_id_number: '',
            guarantor_1_phone: '',
            guarantor_1_address: '',
            guarantor_2_name: '',
            guarantor_2_id_type: 'ghana_card',
            guarantor_2_id_number: '',
            guarantor_2_phone: '',
            guarantor_2_address: '',
            loan_amount: '',
            loan_purpose: '',
            repayment_period_months: '',
            monthly_income: '',
            employment_status: ''
         });
      } catch (error) {
         alert('Error submitting loan application');
      }
   };

   const handlePaymentSubmit = async (e) => {
      e.preventDefault();
      try {
         // This would integrate with backend payment collection endpoint
         alert('Payment collected successfully!');
         setShowPaymentModal(false);
         setPaymentForm({ member_id: '', amount: '', payment_type: 'cash' });
      } catch (error) {
         alert('Error processing payment');
      }
   };

   const handleDepositSubmit = async (e) => {
      e.preventDefault();
      try {
         const response = await api.post('operations/process_deposit/', depositForm);
         alert(`Deposit processed successfully!\nReference: ${response.data.reference}\nNew Balance: GHS ${response.data.new_balance}`);
         setShowDepositModal(false);
         setDepositForm({ member_id: '', amount: '', deposit_type: 'member_savings', account_number: '' });
      } catch (error) {
         alert(`Error processing deposit: ${error.response?.data?.error || 'Unknown error'}`);
      }
   };

   const handleWithdrawalSubmit = async (e) => {
      e.preventDefault();
      try {
         const response = await api.post('operations/process_withdrawal/', withdrawalForm);
         alert(`Withdrawal processed successfully!\nReference: ${response.data.reference}\nNew Balance: GHS ${response.data.new_balance}`);
         setShowWithdrawalModal(false);
         setWithdrawalForm({ member_id: '', amount: '', withdrawal_type: 'withdrawal_member_savings', account_number: '' });
      } catch (error) {
         alert(`Error processing withdrawal: ${error.response?.data?.error || 'Unknown error'}`);
      }
   };

   const handleMessageSubmit = async (e) => {
     e.preventDefault();
     try {
       await api.post('operations/messages/', messageForm);
       alert('Message sent successfully!');
       setShowMessageModal(false);
       setMessageForm({ recipient: '', subject: '', content: '', priority: 'normal' });
       // Refresh messages
       fetchMessages();
     } catch (error) {
       console.error('Error sending message:', error);
       alert(`Error sending message: ${error.response?.data?.error || 'Unknown error'}`);
     }
   };

   const handleScheduleSubmit = async (e) => {
      e.preventDefault();
      try {
         const response = await api.post('operations/schedule_visit/', scheduleForm);
         setScheduledVisits([...scheduledVisits, response.data]);
         alert('Visit scheduled successfully!');
         setShowScheduleModal(false);
         setScheduleForm({
            client_name: '',
            location: '',
            scheduled_date: '',
            scheduled_time: '',
            purpose: '',
            assigned_to: ''
         });
      } catch (error) {
         alert(`Error scheduling visit: ${error.response?.data?.error || 'Unknown error'}`);
      }
   };

  const fieldMetrics = [
    { label: 'Scheduled Visits', value: loadingMetrics ? '...' : metrics.scheduled_visits.toString(), icon: '📅', color: '#3b82f6' },
    { label: 'Completed Today', value: loadingMetrics ? '...' : metrics.completed_today.toString(), icon: '✅', color: '#10b981' },
    { label: 'Collections Due', value: loadingMetrics ? '...' : formatCurrencyGHS(metrics.collections_due), icon: '💰', color: '#f59e0b' },
    { label: 'New Applications', value: loadingMetrics ? '...' : metrics.new_applications.toString(), icon: '📋', color: '#8b5cf6' }
  ];

  const assignedClients = [
    { 
      id: 1, 
      name: 'Kwame Asare', 
      location: 'East Legon', 
      status: 'Due Payment', 
      amountDue: formatCurrencyGHS(1500),
      nextVisit: 'Today 2:00 PM',
      priority: 'high'
    },
    { 
      id: 2, 
      name: 'Abena Mensah', 
      location: 'Madina', 
      status: 'Loan Application', 
      amountDue: null,
      nextVisit: 'Tomorrow 10:00 AM',
      priority: 'medium'
    },
    { 
      id: 3, 
      name: 'Kofi Appiah', 
      location: 'Tema', 
      status: 'Account Opening', 
      amountDue: null,
      nextVisit: 'Today 4:30 PM',
      priority: 'medium'
    },
    { 
      id: 4, 
      name: 'Ama Osei', 
      location: 'Dansoman', 
      status: 'Overdue Payment', 
      amountDue: formatCurrencyGHS(2500),
      nextVisit: 'ASAP',
      priority: 'high'
    }
  ];

  const dailyCollections = {
    target: formatCurrencyGHS(20000),
    collected: loadingMetrics ? '...' : formatCurrencyGHS(metrics.collections_today_amount || 0),
    remaining: formatCurrencyGHS(Math.max(0, 20000 - (metrics.collections_today_amount || 0))),
    completion: loadingMetrics ? '...' : `${Math.round(((metrics.collections_today_amount || 0) / 20000) * 100)}%`
  };

  return (
    <div style={{
      minHeight: '100vh',
      background: 'var(--md-sys-color-background)',
      padding: '16px'
    }}>
      {/* App Bar */}
      <header className="md-elevated-card md-animate-slide-in-down" style={{
        marginBottom: '24px',
        padding: '20px 24px'
      }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '16px', marginBottom: '24px' }}>
          <div>
            <h1 className="md-typescale-headline-medium" style={{
              color: 'var(--md-sys-color-on-surface)',
              marginBottom: '4px'
            }}>
              Mobile Banking Operations
            </h1>
            <p className="md-typescale-body-medium" style={{
              color: 'var(--md-sys-color-on-surface-variant)'
            }}>
              Welcome, {user?.name} • Field operations dashboard
            </p>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
            <div className="md-chip" style={{
              background: 'var(--md-sys-color-secondary-container)',
              color: 'var(--md-sys-color-on-secondary-container)',
              border: 'none'
            }}>
              🚗 MOBILE BANKER
            </div>
            <button
              onClick={handleLogout}
              className="md-filled-button md-ripple"
              style={{
                background: 'var(--md-sys-color-error)',
                color: 'var(--md-sys-color-on-error)'
              }}
            >
              Logout
            </button>
          </div>
        </div>

        {/* Field Metrics */}
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
          gap: '12px'
        }}>
          {fieldMetrics.map((metric, index) => (
            <div key={index} className="md-filled-card md-state-layer" style={{
              padding: '16px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px',
              cursor: 'pointer'
            }}>
              <div style={{
                width: '48px',
                height: '48px',
                background: metric.color,
                borderRadius: 'var(--md-sys-shape-corner-medium)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '20px',
                color: 'white',
                flexShrink: 0
              }}>
                {metric.icon}
              </div>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div className="md-typescale-title-large" style={{
                  color: 'var(--md-sys-color-on-surface)',
                  marginBottom: '2px'
                }}>
                  {metric.value}
                </div>
                <div className="md-typescale-body-small" style={{
                  color: 'var(--md-sys-color-on-surface-variant)'
                }}>
                  {metric.label}
                </div>
              </div>
            </div>
          ))}
        </div>
      </header>

      <div style={{ 
        display: 'grid', 
        gridTemplateColumns: '2fr 1fr', 
        gap: '24px' 
      }}>
        {/* Main Content */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
          {/* Client List */}
          <div className="md-elevated-card md-animate-slide-in-up">
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
              <h3 className="md-typescale-title-large" style={{
                color: 'var(--md-sys-color-on-surface)',
                display: 'flex',
                alignItems: 'center',
                gap: '10px'
              }}>
                👥 Assigned Clients
              </h3>
              <div style={{
                display: 'flex',
                gap: '8px',
                padding: '4px',
                background: 'var(--md-sys-color-surface-container-highest)',
                borderRadius: 'var(--md-sys-shape-corner-large)'
              }}>
                <button
                  onClick={() => setActiveTab('clients')}
                  className="md-ripple"
                  style={{
                    padding: '8px 16px',
                    background: activeTab === 'clients' ? 'var(--md-sys-color-surface)' : 'transparent',
                    border: 'none',
                    borderRadius: 'var(--md-sys-shape-corner-medium)',
                    color: activeTab === 'clients' ? 'var(--md-sys-color-on-surface)' : 'var(--md-sys-color-on-surface-variant)',
                    fontWeight: activeTab === 'clients' ? '600' : '500',
                    cursor: 'pointer',
                    boxShadow: activeTab === 'clients' ? 'var(--md-sys-elevation-1)' : 'none',
                    transition: 'all var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard)'
                  }}
                >
                  Clients
                </button>
                <button
                  onClick={() => setActiveTab('visits')}
                  className="md-ripple"
                  style={{
                    padding: '8px 16px',
                    background: activeTab === 'visits' ? 'var(--md-sys-color-surface)' : 'transparent',
                    border: 'none',
                    borderRadius: 'var(--md-sys-shape-corner-medium)',
                    color: activeTab === 'visits' ? 'var(--md-sys-color-on-surface)' : 'var(--md-sys-color-on-surface-variant)',
                    fontWeight: activeTab === 'visits' ? '600' : '500',
                    cursor: 'pointer',
                    boxShadow: activeTab === 'visits' ? 'var(--md-sys-elevation-1)' : 'none',
                    transition: 'all var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard)'
                  }}
                >
                  Visit Schedule
                </button>
              </div>
            </div>

            {activeTab === 'clients' && (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                {assignedClients.map((client) => (
                  <div key={client.id} style={{
                    display: 'flex',
                    alignItems: 'center',
                    padding: '20px',
                    background: client.priority === 'high' ? '#fef2f2' : '#f8fafc',
                    borderRadius: '12px',
                    border: `1px solid ${client.priority === 'high' ? '#fecaca' : '#e2e8f0'}`,
                    transition: 'all 0.2s',
                    cursor: 'pointer'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = client.priority === 'high' ? '#fee2e2' : '#f1f5f9';
                    e.currentTarget.style.transform = 'translateX(4px)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = client.priority === 'high' ? '#fef2f2' : '#f8fafc';
                    e.currentTarget.style.transform = 'translateX(0)';
                  }}>
                    <div style={{
                      width: '44px',
                      height: '44px',
                      background: client.priority === 'high' ? '#ef4444' : '#3b82f6',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white',
                      fontWeight: '600',
                      fontSize: '14px',
                      marginRight: '16px'
                    }}>
                      {client.name.split(' ').map(n => n[0]).join('')}
                    </div>

                    <div style={{ flex: 1 }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '4px' }}>
                        <div style={{
                          color: '#1e293b',
                          fontWeight: '600',
                          fontSize: '16px'
                        }}>
                          {client.name}
                        </div>
                        <div style={{
                          background: client.priority === 'high' ? '#ef4444' : '#f59e0b',
                          color: 'white',
                          padding: '2px 8px',
                          borderRadius: '12px',
                          fontSize: '10px',
                          fontWeight: '600'
                        }}>
                          {client.priority === 'high' ? 'URGENT' : 'MEDIUM'}
                        </div>
                      </div>
                      <div style={{
                        color: '#64748b',
                        fontSize: '14px',
                        marginBottom: '4px'
                      }}>
                        📍 {client.location} • {client.status}
                      </div>
                      <div style={{
                        color: '#64748b',
                        fontSize: '12px'
                      }}>
                        🕐 Next Visit: {client.nextVisit}
                      </div>
                    </div>

                    {client.amountDue && (
                      <div style={{ textAlign: 'right' }}>
                        <div style={{
                          color: '#ef4444',
                          fontWeight: '700',
                          fontSize: '16px'
                        }}>
                          {client.amountDue}
                        </div>
                        <div style={{
                          color: '#64748b',
                          fontSize: '12px'
                        }}>
                          Due
                        </div>
                      </div>
                    )}

                    <button style={{
                      padding: '8px 16px',
                      background: '#3b82f6',
                      border: 'none',
                      borderRadius: '8px',
                      color: 'white',
                      fontWeight: '600',
                      fontSize: '12px',
                      cursor: 'pointer',
                      marginLeft: '12px'
                    }}>
                      Visit
                    </button>
                  </div>
                ))}
              </div>
            )}

            {activeTab === 'visits' && (
              <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                  <h4 style={{ margin: 0, color: '#1e293b', fontSize: '18px', fontWeight: '600' }}>
                    📅 Scheduled Visits
                  </h4>
                  <button
                    onClick={() => setShowScheduleModal(true)}
                    style={{
                      padding: '8px 16px',
                      background: '#10b981',
                      border: 'none',
                      borderRadius: '8px',
                      color: 'white',
                      fontWeight: '600',
                      fontSize: '14px',
                      cursor: 'pointer'
                    }}
                  >
                    + Schedule Visit
                  </button>
                </div>

                {loadingVisits ? (
                  <div style={{ textAlign: 'center', padding: '40px', color: '#64748b' }}>
                    Loading visits...
                  </div>
                ) : scheduledVisits.length > 0 ? (
                  scheduledVisits.map((visit) => (
                    <div key={visit.id} style={{
                      display: 'flex',
                      alignItems: 'center',
                      padding: '20px',
                      background: '#f8fafc',
                      borderRadius: '12px',
                      border: '1px solid #e2e8f0',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.background = '#f1f5f9';
                      e.currentTarget.style.transform = 'translateX(4px)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.background = '#f8fafc';
                      e.currentTarget.style.transform = 'translateX(0)';
                    }}>
                      <div style={{
                        width: '44px',
                        height: '44px',
                        background: '#8b5cf6',
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        color: 'white',
                        fontWeight: '600',
                        fontSize: '14px',
                        marginRight: '16px'
                      }}>
                        {visit.client_name.split(' ').map(n => n[0]).join('')}
                      </div>

                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '4px' }}>
                          <div style={{
                            color: '#1e293b',
                            fontWeight: '600',
                            fontSize: '16px'
                          }}>
                            {visit.client_name}
                          </div>
                          <div style={{
                            background: visit.status === 'completed' ? '#10b981' : visit.status === 'cancelled' ? '#ef4444' : '#f59e0b',
                            color: 'white',
                            padding: '2px 8px',
                            borderRadius: '12px',
                            fontSize: '10px',
                            fontWeight: '600'
                          }}>
                            {visit.status.toUpperCase()}
                          </div>
                        </div>
                        <div style={{
                          color: '#64748b',
                          fontSize: '14px',
                          marginBottom: '4px'
                        }}>
                          📍 {visit.location} • {visit.purpose.replace('_', ' ')}
                        </div>
                        <div style={{
                          color: '#64748b',
                          fontSize: '12px'
                        }}>
                          🕐 {visit.scheduled_date} at {visit.scheduled_time}
                        </div>
                      </div>

                      {visit.status === 'scheduled' && (
                        <div style={{ display: 'flex', gap: '8px' }}>
                          <button style={{
                            padding: '6px 12px',
                            background: '#3b82f6',
                            border: 'none',
                            borderRadius: '6px',
                            color: 'white',
                            fontWeight: '600',
                            fontSize: '12px',
                            cursor: 'pointer'
                          }}>
                            Start Visit
                          </button>
                          <button style={{
                            padding: '6px 12px',
                            background: '#ef4444',
                            border: 'none',
                            borderRadius: '6px',
                            color: 'white',
                            fontWeight: '600',
                            fontSize: '12px',
                            cursor: 'pointer'
                          }}>
                            Cancel
                          </button>
                        </div>
                      )}
                    </div>
                  ))
                ) : (
                  <div style={{
                    textAlign: 'center',
                    padding: '40px',
                    color: '#64748b',
                    fontSize: '16px'
                  }}>
                    No scheduled visits yet. Click "Schedule Visit" to add one.
                  </div>
                )}
              </div>
            )}
          </div>

          {/* Quick Actions */}
          <div className="md-elevated-card md-animate-slide-in-up" style={{ animationDelay: '100ms' }}>
            <h3 className="md-typescale-title-large" style={{
              color: 'var(--md-sys-color-on-surface)',
              marginBottom: '20px'
            }}>
              🚀 Quick Actions
            </h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px' }}>
              {[
                { label: 'Process Deposit', icon: '💰', color: '#10b981' },
                { label: 'Process Withdrawal', icon: '💸', color: '#ef4444' },
                { label: 'New Loan Application', icon: '📝', color: '#8b5cf6' },
                { label: 'Collect Payment', icon: '💳', color: '#3b82f6' },
                { label: 'Upload KYC Documents', icon: '📄', color: '#f59e0b' },
                { label: 'Schedule Visit', icon: '📅', color: '#06b6d4' }
              ].map((action, index) => (
                <button key={index} style={{
                  padding: '20px',
                  background: '#f8fafc',
                  border: '1px solid #e2e8f0',
                  borderRadius: '12px',
                  color: '#374151',
                  fontWeight: '600',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px',
                  transition: 'all 0.2s'
                }}
                onClick={() => {
                  const actionMap = {
                    'Process Deposit': 'deposit',
                    'Process Withdrawal': 'withdrawal',
                    'New Loan Application': 'loan',
                    'Collect Payment': 'payment',
                    'Upload KYC Documents': 'kyc',
                    'Schedule Visit': 'visit'
                  };
                  handleQuickAction(actionMap[action.label]);
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = action.color;
                  e.currentTarget.style.color = 'white';
                  e.currentTarget.style.transform = 'translateY(-2px)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = '#f8fafc';
                  e.currentTarget.style.color = '#374151';
                  e.currentTarget.style.transform = 'translateY(0)';
                }}>
                  <span style={{ fontSize: '20px' }}>{action.icon}</span>
                  {action.label}
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Sidebar */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
          {/* Collection Tracker */}
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '24px',
            boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
            border: '1px solid #e2e8f0'
          }}>
            <h4 style={{ 
              margin: '0 0 16px 0', 
              color: '#1e293b',
              fontSize: '16px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}>
              💰 Daily Collection Target
            </h4>
            
            <div style={{ marginBottom: '16px' }}>
              <div style={{ 
                color: '#1e293b',
                fontSize: '20px',
                fontWeight: '700',
                marginBottom: '4px'
              }}>
                {dailyCollections.collected}
              </div>
              <div style={{ 
                color: '#64748b',
                fontSize: '14px'
              }}>
                Collected of {dailyCollections.target}
              </div>
            </div>

            {/* Progress Bar */}
            <div style={{
              width: '100%',
              height: '8px',
              background: '#e2e8f0',
              borderRadius: '4px',
              marginBottom: '8px',
              overflow: 'hidden'
            }}>
              <div style={{
                width: loadingMetrics ? '0%' : `${Math.min(100, ((metrics.collections_today_amount || 0) / 20000) * 100)}%`,
                height: '100%',
                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                borderRadius: '4px'
              }}></div>
            </div>

            <div style={{ 
              color: '#64748b',
              fontSize: '12px',
              textAlign: 'center'
            }}>
              {dailyCollections.completion} Complete • {dailyCollections.remaining} remaining
            </div>
          </div>

          {/* Messaging Center */}
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '24px',
            boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
            border: '1px solid #e2e8f0'
          }}>
            <h4 style={{ 
              margin: '0 0 16px 0', 
              color: '#1e293b',
              fontSize: '16px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}>
              📱 Messaging Center
            </h4>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              {loadingMessages ? (
                <div style={{ textAlign: 'center', padding: '20px', color: '#64748b' }}>
                  Loading messages...
                </div>
              ) : messages.length === 0 ? (
                <div style={{ textAlign: 'center', padding: '20px', color: '#64748b' }}>
                  No messages yet
                </div>
              ) : (
                messages.slice(0, 3).map((msg, index) => (
                  <div key={msg.id || index} style={{
                    padding: '12px',
                    background: msg.is_read ? '#f8fafc' : '#e0f2fe',
                    border: `1px solid ${msg.is_read ? '#e2e8f0' : '#0ea5e9'}`,
                    borderRadius: '8px',
                    cursor: 'pointer',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = msg.is_read ? '#f1f5f9' : '#bae6fd';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = msg.is_read ? '#f8fafc' : '#e0f2fe';
                  }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '4px' }}>
                      <div style={{
                        fontWeight: '600',
                        fontSize: '14px',
                        color: msg.is_read ? '#1e293b' : '#0369a1'
                      }}>
                        {msg.sender_name || 'System'}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: '#64748b'
                      }}>
                        {new Date(msg.created_at).toLocaleDateString()}
                      </div>
                    </div>
                    <div style={{
                      fontSize: '13px',
                      color: msg.is_read ? '#64748b' : '#0369a1'
                    }}>
                      {msg.subject || msg.content.substring(0, 50) + (msg.content.length > 50 ? '...' : '')}
                    </div>
                  </div>
                ))
              )}
            </div>

            <button style={{
              width: '100%',
              padding: '12px',
              background: '#f8fafc',
              border: '1px solid #e2e8f0',
              borderRadius: '8px',
              color: '#374151',
              fontWeight: '600',
              marginTop: '16px',
              cursor: 'pointer',
              transition: 'all 0.2s'
            }}
            onClick={() => setShowMessageModal(true)}
            onMouseEnter={(e) => {
              e.currentTarget.style.background = '#3b82f6';
              e.currentTarget.style.color = 'white';
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.background = '#f8fafc';
              e.currentTarget.style.color = '#374151';
            }}>
              New Message
            </button>
          </div>
        </div>
      </div>

      {/* Modals */}
      {showLoanModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '900px',
            width: '95%',
            maxHeight: '90vh',
            overflow: 'auto'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              📝 New Loan Application
            </h3>
            <form onSubmit={handleLoanSubmit} style={{ maxHeight: '70vh', overflowY: 'auto' }}>
               {/* Applicant Information */}
               <div style={{ marginBottom: '24px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                 <h4 style={{ margin: '0 0 16px 0', color: '#1e293b', fontSize: '16px', fontWeight: '600' }}>Applicant Information</h4>

                 <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px' }}>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Applicant Name
                     </label>
                     <input
                       type="text"
                       value={loanForm.applicant_name}
                       onChange={(e) => setLoanForm({...loanForm, applicant_name: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Date of Birth
                     </label>
                     <input
                       type="date"
                       value={loanForm.date_of_birth}
                       onChange={(e) => setLoanForm({...loanForm, date_of_birth: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                 </div>

                 <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '16px', marginBottom: '16px' }}>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       ID Type
                     </label>
                     <select
                       value={loanForm.applicant_id_type}
                       onChange={(e) => setLoanForm({...loanForm, applicant_id_type: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     >
                       <option value="ghana_card">Ghana Card</option>
                       <option value="voters_id">Voters ID</option>
                       <option value="drivers_license">Drivers License</option>
                     </select>
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       ID Number
                     </label>
                     <input
                       type="text"
                       value={loanForm.applicant_id_number}
                       onChange={(e) => setLoanForm({...loanForm, applicant_id_number: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                 </div>
               </div>

               {/* Contact Address */}
               <div style={{ marginBottom: '24px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                 <h4 style={{ margin: '0 0 16px 0', color: '#1e293b', fontSize: '16px', fontWeight: '600' }}>Contact Address</h4>

                 <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '16px' }}>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Digital Address
                     </label>
                     <input
                       type="text"
                       value={loanForm.digital_address}
                       onChange={(e) => setLoanForm({...loanForm, digital_address: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                     />
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Town
                     </label>
                     <input
                       type="text"
                       value={loanForm.town}
                       onChange={(e) => setLoanForm({...loanForm, town: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       City
                     </label>
                     <input
                       type="text"
                       value={loanForm.city}
                       onChange={(e) => setLoanForm({...loanForm, city: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                 </div>
               </div>

               {/* Next of Kin */}
               <div style={{ marginBottom: '24px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                 <h4 style={{ margin: '0 0 16px 0', color: '#1e293b', fontSize: '16px', fontWeight: '600' }}>Next of Kin (At least 2 required)</h4>

                 {/* Next of Kin 1 */}
                 <div style={{ marginBottom: '16px', padding: '12px', background: 'white', borderRadius: '6px' }}>
                   <h5 style={{ margin: '0 0 12px 0', color: '#374151', fontSize: '14px', fontWeight: '600' }}>Next of Kin 1</h5>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' }}>
                     <input
                       type="text"
                       placeholder="Full Name"
                       value={loanForm.next_of_kin_1_name}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_1_name: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                     <input
                       type="text"
                       placeholder="Relationship"
                       value={loanForm.next_of_kin_1_relationship}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_1_relationship: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px' }}>
                     <input
                       type="tel"
                       placeholder="Phone Number"
                       value={loanForm.next_of_kin_1_phone}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_1_phone: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                     <textarea
                       placeholder="Address"
                       value={loanForm.next_of_kin_1_address}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_1_address: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px',
                         minHeight: '60px'
                       }}
                       required
                     />
                   </div>
                 </div>

                 {/* Next of Kin 2 */}
                 <div style={{ padding: '12px', background: 'white', borderRadius: '6px' }}>
                   <h5 style={{ margin: '0 0 12px 0', color: '#374151', fontSize: '14px', fontWeight: '600' }}>Next of Kin 2</h5>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' }}>
                     <input
                       type="text"
                       placeholder="Full Name"
                       value={loanForm.next_of_kin_2_name}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_2_name: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                     <input
                       type="text"
                       placeholder="Relationship"
                       value={loanForm.next_of_kin_2_relationship}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_2_relationship: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px' }}>
                     <input
                       type="tel"
                       placeholder="Phone Number"
                       value={loanForm.next_of_kin_2_phone}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_2_phone: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                     <textarea
                       placeholder="Address"
                       value={loanForm.next_of_kin_2_address}
                       onChange={(e) => setLoanForm({...loanForm, next_of_kin_2_address: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px',
                         minHeight: '60px'
                       }}
                       required
                     />
                   </div>
                 </div>
               </div>

               {/* Guarantors */}
               <div style={{ marginBottom: '24px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                 <h4 style={{ margin: '0 0 16px 0', color: '#1e293b', fontSize: '16px', fontWeight: '600' }}>Guarantors</h4>

                 {/* Guarantor 1 */}
                 <div style={{ marginBottom: '16px', padding: '12px', background: 'white', borderRadius: '6px' }}>
                   <h5 style={{ margin: '0 0 12px 0', color: '#374151', fontSize: '14px', fontWeight: '600' }}>Guarantor 1</h5>
                   <div style={{ marginBottom: '12px' }}>
                     <input
                       type="text"
                       placeholder="Full Name"
                       value={loanForm.guarantor_1_name}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_1_name: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px', marginBottom: '12px' }}>
                     <select
                       value={loanForm.guarantor_1_id_type}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_1_id_type: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     >
                       <option value="ghana_card">Ghana Card</option>
                       <option value="voters_id">Voters ID</option>
                       <option value="drivers_license">Drivers License</option>
                     </select>
                     <input
                       type="text"
                       placeholder="ID Number"
                       value={loanForm.guarantor_1_id_number}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_1_id_number: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px' }}>
                     <input
                       type="tel"
                       placeholder="Phone Number"
                       value={loanForm.guarantor_1_phone}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_1_phone: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                       required
                     />
                     <textarea
                       placeholder="Address"
                       value={loanForm.guarantor_1_address}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_1_address: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px',
                         minHeight: '60px'
                       }}
                       required
                     />
                   </div>
                 </div>

                 {/* Guarantor 2 (Optional) */}
                 <div style={{ padding: '12px', background: 'white', borderRadius: '6px' }}>
                   <h5 style={{ margin: '0 0 12px 0', color: '#374151', fontSize: '14px', fontWeight: '600' }}>Guarantor 2 (Optional)</h5>
                   <div style={{ marginBottom: '12px' }}>
                     <input
                       type="text"
                       placeholder="Full Name"
                       value={loanForm.guarantor_2_name}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_2_name: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px', marginBottom: '12px' }}>
                     <select
                       value={loanForm.guarantor_2_id_type}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_2_id_type: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                     >
                       <option value="ghana_card">Ghana Card</option>
                       <option value="voters_id">Voters ID</option>
                       <option value="drivers_license">Drivers License</option>
                     </select>
                     <input
                       type="text"
                       placeholder="ID Number"
                       value={loanForm.guarantor_2_id_number}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_2_id_number: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                     />
                   </div>
                   <div style={{ display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '12px' }}>
                     <input
                       type="tel"
                       placeholder="Phone Number"
                       value={loanForm.guarantor_2_phone}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_2_phone: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px'
                       }}
                     />
                     <textarea
                       placeholder="Address"
                       value={loanForm.guarantor_2_address}
                       onChange={(e) => setLoanForm({...loanForm, guarantor_2_address: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '10px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '6px',
                         fontSize: '14px',
                         minHeight: '60px'
                       }}
                     />
                   </div>
                 </div>
               </div>

               {/* Loan Details */}
               <div style={{ marginBottom: '24px', padding: '16px', background: '#f8fafc', borderRadius: '8px' }}>
                 <h4 style={{ margin: '0 0 16px 0', color: '#1e293b', fontSize: '16px', fontWeight: '600' }}>Loan Details</h4>

                 <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px' }}>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Loan Amount (GHS)
                     </label>
                     <input
                       type="number"
                       value={loanForm.loan_amount}
                       onChange={(e) => setLoanForm({...loanForm, loan_amount: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Repayment Period (Months)
                     </label>
                     <input
                       type="number"
                       value={loanForm.repayment_period_months}
                       onChange={(e) => setLoanForm({...loanForm, repayment_period_months: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                 </div>

                 <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px' }}>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Monthly Income (GHS)
                     </label>
                     <input
                       type="number"
                       value={loanForm.monthly_income}
                       onChange={(e) => setLoanForm({...loanForm, monthly_income: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     />
                   </div>
                   <div>
                     <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                       Employment Status
                     </label>
                     <select
                       value={loanForm.employment_status}
                       onChange={(e) => setLoanForm({...loanForm, employment_status: e.target.value})}
                       style={{
                         width: '100%',
                         padding: '12px',
                         border: '1px solid #e2e8f0',
                         borderRadius: '8px',
                         fontSize: '14px'
                       }}
                       required
                     >
                       <option value="">Select Status</option>
                       <option value="employed">Employed</option>
                       <option value="self_employed">Self Employed</option>
                       <option value="unemployed">Unemployed</option>
                       <option value="student">Student</option>
                       <option value="retired">Retired</option>
                     </select>
                   </div>
                 </div>

                 <div>
                   <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600', fontSize: '14px' }}>
                     Loan Purpose
                   </label>
                   <textarea
                     value={loanForm.loan_purpose}
                     onChange={(e) => setLoanForm({...loanForm, loan_purpose: e.target.value})}
                     style={{
                       width: '100%',
                       padding: '12px',
                       border: '1px solid #e2e8f0',
                       borderRadius: '8px',
                       fontSize: '14px',
                       minHeight: '80px'
                     }}
                     required
                   />
                 </div>
               </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#10b981',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Submit Application
                </button>
                <button
                  type="button"
                  onClick={() => setShowLoanModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {showPaymentModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              💰 Collect Payment
            </h3>
            <form onSubmit={handlePaymentSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Member ID
                </label>
                <input
                  type="text"
                  value={paymentForm.member_id}
                  onChange={(e) => setPaymentForm({...paymentForm, member_id: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Amount (GHS)
                </label>
                <input
                  type="number"
                  value={paymentForm.amount}
                  onChange={(e) => setPaymentForm({...paymentForm, amount: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Payment Type
                </label>
                <select
                  value={paymentForm.payment_type}
                  onChange={(e) => setPaymentForm({...paymentForm, payment_type: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  <option value="cash">Cash</option>
                  <option value="cheque">Cheque</option>
                  <option value="mobile_money">Mobile Money</option>
                </select>
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#10b981',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Process Payment
                </button>
                <button
                  type="button"
                  onClick={() => setShowPaymentModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {showDepositModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              💰 Process Deposit
            </h3>
            <form onSubmit={handleDepositSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Member ID
                </label>
                <input
                  type="text"
                  value={depositForm.member_id}
                  onChange={(e) => setDepositForm({...depositForm, member_id: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Account Number
                </label>
                <input
                  type="text"
                  value={depositForm.account_number}
                  onChange={(e) => setDepositForm({...depositForm, account_number: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Amount (GHS)
                </label>
                <input
                  type="number"
                  value={depositForm.amount}
                  onChange={(e) => setDepositForm({...depositForm, amount: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Deposit Type
                </label>
                <select
                  value={depositForm.deposit_type}
                  onChange={(e) => setDepositForm({...depositForm, deposit_type: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  <option value="shares">Shares</option>
                  <option value="member_savings">Member Savings</option>
                  <option value="daily_savings">Daily Savings</option>
                  <option value="youth_savings">Youth Savings</option>
                </select>
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#10b981',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Process Deposit
                </button>
                <button
                  type="button"
                  onClick={() => setShowDepositModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {showWithdrawalModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              💸 Process Withdrawal
            </h3>
            <form onSubmit={handleWithdrawalSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Member ID
                </label>
                <input
                  type="text"
                  value={withdrawalForm.member_id}
                  onChange={(e) => setWithdrawalForm({...withdrawalForm, member_id: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Account Number
                </label>
                <input
                  type="text"
                  value={withdrawalForm.account_number}
                  onChange={(e) => setWithdrawalForm({...withdrawalForm, account_number: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Amount (GHS)
                </label>
                <input
                  type="number"
                  value={withdrawalForm.amount}
                  onChange={(e) => setWithdrawalForm({...withdrawalForm, amount: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Withdrawal Type
                </label>
                <select
                  value={withdrawalForm.withdrawal_type}
                  onChange={(e) => setWithdrawalForm({...withdrawalForm, withdrawal_type: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  <option value="withdrawal_member_savings">Member Savings</option>
                  <option value="withdrawal_daily_savings">Daily Savings</option>
                  <option value="withdrawal_youth_savings">Youth Savings</option>
                </select>
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#ef4444',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Process Withdrawal
                </button>
                <button
                  type="button"
                  onClick={() => setShowWithdrawalModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {showMessageModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              📱 Send Message
            </h3>
            <form onSubmit={handleMessageSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Recipient (leave empty for broadcast)
                </label>
                <input
                  type="text"
                  value={messageForm.recipient}
                  onChange={(e) => setMessageForm({...messageForm, recipient: e.target.value})}
                  placeholder="Enter recipient ID or leave empty"
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Subject
                </label>
                <input
                  type="text"
                  value={messageForm.subject}
                  onChange={(e) => setMessageForm({...messageForm, subject: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Priority
                </label>
                <select
                  value={messageForm.priority}
                  onChange={(e) => setMessageForm({...messageForm, priority: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  <option value="low">Low</option>
                  <option value="normal">Normal</option>
                  <option value="high">High</option>
                  <option value="urgent">Urgent</option>
                </select>
              </div>
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Message
                </label>
                <textarea
                  value={messageForm.content}
                  onChange={(e) => setMessageForm({...messageForm, content: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px',
                    minHeight: '100px'
                  }}
                  required
                />
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#3b82f6',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Send Message
                </button>
                <button
                  type="button"
                  onClick={() => setShowMessageModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {showScheduleModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              📅 Schedule Visit
            </h3>
            <form onSubmit={handleScheduleSubmit}>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Client Name
                </label>
                <input
                  type="text"
                  value={scheduleForm.client_name}
                  onChange={(e) => setScheduleForm({...scheduleForm, client_name: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Location
                </label>
                <input
                  type="text"
                  value={scheduleForm.location}
                  onChange={(e) => setScheduleForm({...scheduleForm, location: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Scheduled Date
                </label>
                <input
                  type="date"
                  value={scheduleForm.scheduled_date}
                  onChange={(e) => setScheduleForm({...scheduleForm, scheduled_date: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Scheduled Time
                </label>
                <input
                  type="time"
                  value={scheduleForm.scheduled_time}
                  onChange={(e) => setScheduleForm({...scheduleForm, scheduled_time: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', color: '#374151', fontWeight: '600' }}>
                  Purpose
                </label>
                <select
                  value={scheduleForm.purpose}
                  onChange={(e) => setScheduleForm({...scheduleForm, purpose: e.target.value})}
                  style={{
                    width: '100%',
                    padding: '12px',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                >
                  <option value="">Select Purpose</option>
                  <option value="Loan follow-up">Loan Follow-up</option>
                  <option value="Account opening">Account Opening</option>
                  <option value="Savings collection">Savings Collection</option>
                  <option value="Payment collection">Payment Collection</option>
                  <option value="KYC update">KYC Update</option>
                  <option value="General inquiry">General Inquiry</option>
                </select>
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button
                  type="submit"
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#10b981',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Schedule Visit
                </button>
                <button
                  type="button"
                  onClick={() => setShowScheduleModal(false)}
                  style={{
                    flex: 1,
                    padding: '12px',
                    background: '#f3f4f6',
                    color: '#374151',
                    border: '1px solid #e2e8f0',
                    borderRadius: '8px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Placeholder modals for KYC and Visit */}
      {showKycModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              📄 Upload KYC Documents
            </h3>
            <p style={{ color: '#64748b', marginBottom: '20px' }}>
              KYC document upload functionality will be implemented soon.
            </p>
            <button
              onClick={() => setShowKycModal(false)}
              style={{
                width: '100%',
                padding: '12px',
                background: '#f3f4f6',
                color: '#374151',
                border: '1px solid #e2e8f0',
                borderRadius: '8px',
                fontWeight: '600',
                cursor: 'pointer'
              }}
            >
              Close
            </button>
          </div>
        </div>
      )}

      {showVisitModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'rgba(0,0,0,0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            background: 'white',
            borderRadius: '16px',
            padding: '30px',
            maxWidth: '500px',
            width: '90%'
          }}>
            <h3 style={{ margin: '0 0 20px 0', color: '#1e293b', fontSize: '20px', fontWeight: '600' }}>
              📅 Schedule Visit
            </h3>
            <p style={{ color: '#64748b', marginBottom: '20px' }}>
              Visit scheduling functionality will be implemented soon.
            </p>
            <button
              onClick={() => setShowVisitModal(false)}
              style={{
                width: '100%',
                padding: '12px',
                background: '#f3f4f6',
                color: '#374151',
                border: '1px solid #e2e8f0',
                borderRadius: '8px',
                fontWeight: '600',
                cursor: 'pointer'
              }}
            >
              Close
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

export default MobileBankerDashboard;