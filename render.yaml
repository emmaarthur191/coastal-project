# Render Blueprint for Coastal Banking Application
# Note: Database and frontend are managed separately in Render Dashboard
# This blueprint only manages the backend service

services:
  # =============================================================================
  # Backend - Django API
  # =============================================================================
  - type: web
    name: coastal-backend
    runtime: python
    region: oregon
    plan: free
    rootDir: banking_backend
    buildCommand: |
      pip install -r requirements.txt
      python manage.py collectstatic --noinput
      python manage.py migrate --noinput
      python manage.py create_initial_users
    startCommand: daphne -b 0.0.0.0 -p $PORT config.asgi:application
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "false"
      - key: ALLOWED_HOSTS
        value: ".onrender.com"
      - key: CORS_ALLOWED_ORIGINS
        sync: false
      - key: DATABASE_URL
        sync: false  # Set manually to your existing database connection string
      - key: ADMIN_EMAIL
        value: "admin@coastal.com"
      - key: ADMIN_PASSWORD
        sync: false
      - key: MANAGER_EMAIL
        value: "manager@coastal.com"
      - key: MANAGER_PASSWORD
        sync: false
      - key: SENDEXA_API_URL
        sync: false
      - key: SENDEXA_AUTH_TOKEN
        sync: false
      - key: SENDEXA_SENDER_ID
        value: "CoastalBank"
      - key: SENTRY_DSN
        sync: false
      - key: APP_VERSION
        value: "1.0.0"
    healthCheckPath: /api/performance/system-health/
    autoDeploy: true

# =============================================================================
# NOTE: Frontend and Database are managed separately
# =============================================================================
# Frontend: Create a Static Site manually in the Render Dashboard
#   - Root Directory: frontend
#   - Build Command: npm install && npm run build
#   - Publish Directory: ./dist
#   - Add rewrite rule: /* -> /index.html
#
# Database: Use your existing coastal-db database
#   - Copy the Internal Database URL to the backend's DATABASE_URL env var
